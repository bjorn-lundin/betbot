<!doctype html>
<html lang="se-sv">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- <script src="//code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="//stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

<script>
    
    
//var context = 'yesterdays_bets'
var URL='https://lundin.duckdns.org'
var s1='{"labels":["2019-01", "2019-02", "2019-03", "2019-04"],"datasets": [{"label": "HORSE_BACK_1_28_02_1_2_PLC_1_01",	"backgroundColor": "red","data": [133, 221, 783, 600]}, {"label": "HORSE_BACK_1_38_00_1_2_PLC_1_01",	"backgroundColor": "green","data": [408, 547, 300, 256]}, {"label": "HORSE_BACK_1_28_02_1_2_PLC_1_01_CHS",	"backgroundColor": "blue","data": [40, 23, 21, 16]}]}'
var s2='{"labels":["2018-47", "2018-48", "2018-49", "2018-50", "2018-51", "2018-52", "2018-53", "2019-01", "2019-02", "2019-03", "2019-04", "2019-05", "2019-06", "2019-07", "2019-08", "2019-09", "2019-10", "2019-11", "2019-12", "2019-13", "2019-14", "2019-15", "2019-16", "2019-17", "2019-18", "2019-19", "2019-20", "2019-21", "2019-22", "2019-23", "2019-24", "2019-25", "2019-26", "2019-27", "2019-28"], "datasets":[{"label":"HORSE_BACK_1_10_07_1_2_PLC_1_01", "backgroundColor":"Lavender", "data":[3.71000E+00, 5.13000E+00, 2.32700E+01, 3.64000E+01, 8.36000E+00, 1.12500E+01, 0.00000E+00, 1.57600E+01, 1.82500E+01, 4.28000E+00, 3.64000E+00, 4.03000E+00, 1.14000E+00, 1.43000E+00, 2.08800E+01, 4.36100E+01, 2.39300E+01, 1.48300E+01, 3.81000E+00, 5.92200E+01, 5.37400E+01, 2.51700E+01, 4.43800E+01, 5.28300E+01, 1.86890E+02, 3.81400E+01, 8.33600E+01, 1.17320E+02, 1.42060E+02, 8.32900E+01, 7.57800E+01, 5.63400E+01, 8.26100E+01, 8.40300E+01, 5.63100E+01]}, {"label":"HORSE_BACK_1_10_07_1_2_PLC_1_01_CHS", "backgroundColor":"Plum", "data":[0.00000E+00, 0.00000E+00, 3.42000E+00, 4.50500E+01, 2.19400E+01, -2.78410E+02, 0.00000E+00, 1.82700E+01, 5.70000E+00, 4.28000E+00, 2.04000E+00, 1.71000E+00, 2.00000E+00, 3.42000E+00, 5.78500E+01, 2.93800E+01, 2.27400E+01, 2.28000E+01, 4.25100E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_10_07_1_2_PLC_1_01_HRD", "backgroundColor":"Orchid", "data":[0.00000E+00, 0.00000E+00, 5.13000E+00, 3.71100E+01, 4.10200E+01, 5.26000E+01, 0.00000E+00, 2.39900E+01, 3.83200E+01, 5.61000E+00, 3.42000E+00, 2.28000E+00, 8.60000E-01, 2.28000E+00, -2.92590E+02, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_10_13_1_2_WIN_1_01", "backgroundColor":"Magenta", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, -2.74400E+01, -1.77800E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_28_02_1_2_PLC_1_01", "backgroundColor":"MediumPurple", "data":[2.58100E+01, 2.14000E+01, 1.26670E+02, 2.00430E+02, 1.93000E+00, 5.91300E+01, 0.00000E+00, 1.53200E+02, 2.46200E+02, 3.43550E+02, 2.20410E+02, 4.97020E+02, -7.91720E+02, 2.13170E+02, 4.34090E+02, 5.75230E+02, -1.52667E+03, -2.05790E+02, 1.64930E+02, -7.50200E+01, -1.68500E+02, 3.49160E+02, 3.55620E+02, -1.44380E+02, 2.15200E+02, 3.76190E+02, -6.93500E+01, -5.91000E+00, -6.52100E+02, 3.56400E+01, 8.30600E+02, 7.29040E+02, 1.23673E+03, 8.26100E+01, 5.98830E+02]}, {"label":"HORSE_BACK_1_28_02_1_2_PLC_1_01_CHS", "backgroundColor":"DarkViolet", "data":[0.00000E+00, 0.00000E+00, 2.19500E+01, 1.55960E+02, 1.26280E+02, -4.94190E+02, 0.00000E+00, 4.23800E+01, 2.78400E+01, 1.13380E+02, 7.29400E+01, 8.18000E+01, 1.17520E+02, -6.45540E+02, 3.98980E+02, 2.24680E+02, 2.39020E+02, 1.11590E+02, 3.09270E+02, 1.24910E+02, 1.09160E+02, 1.13910E+02, 7.32900E+01, 4.96300E+01, -4.45410E+02, 2.60790E+02, 2.30780E+02, 8.11500E+01, 2.65710E+02, 5.37500E+01, 9.54500E+01, 7.86600E+01, 1.30460E+02, 1.14080E+02, 4.80900E+01]}, {"label":"HORSE_BACK_1_28_02_1_2_PLC_1_01_HRD", "backgroundColor":"DarkMagenta", "data":[0.00000E+00, 0.00000E+00, 1.34000E+01, 1.03670E+02, 8.61000E+01, 1.33720E+02, 0.00000E+00, 5.91200E+01, 9.96300E+01, 1.66170E+02, 1.80970E+02, 9.44700E+01, 1.58560E+02, 2.07200E+02, -1.75926E+03, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_38_00_1_2_PLC_1_01", "backgroundColor":"Indigo", "data":[-2.64800E+01, 3.33200E+01, 2.25060E+02, -5.79760E+02, -2.56280E+02, 2.37300E+01, 0.00000E+00, 6.04000E+00, 4.55000E+01, 1.45960E+02, 1.14040E+02, -1.79700E+02, 1.18990E+02, -6.73400E+01, -2.30300E+01, 2.38970E+02, -1.68870E+02, 1.14580E+02, 1.12980E+02, 1.77150E+02, 1.17540E+02, 1.69890E+02, 2.20630E+02, 1.29210E+02, 1.31690E+02, 1.28160E+02, -1.63200E+02, 1.39700E+02, -2.81600E+02, 3.22800E+01, 2.97710E+02, 2.55490E+02, 6.02320E+02, 2.72490E+02, 2.01490E+02]}, {"label":"HORSE_BACK_1_38_00_1_2_PLC_1_01_CHS", "backgroundColor":"SlateBlue", "data":[0.00000E+00, 0.00000E+00, 4.47200E+01, 2.09990E+02, 1.83400E+01, -4.24300E+01, 0.00000E+00, 1.14000E+01, 3.71000E+00, 4.03200E+01, 2.09000E+01, 6.08900E+01, 7.08200E+01, -1.08930E+02, 1.25230E+02, 6.62300E+01, 6.68600E+01, 4.83100E+01, 1.46600E+02, -8.08800E+01, 6.01500E+01, -9.69300E+01, 5.77000E+01, 4.46500E+01, -1.24550E+02, 1.43350E+02, 9.27600E+01, 4.90400E+01, 3.36800E+01, 2.37000E+01, 3.78900E+01, -3.90910E+02, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_38_00_1_2_PLC_1_01_HRD", "backgroundColor":"Olive", "data":[0.00000E+00, 0.00000E+00, 2.68600E+01, -1.68680E+02, 9.41000E+00, 2.53700E+01, 0.00000E+00, 8.71000E+00, 1.83200E+01, -1.10900E+01, 7.27100E+01, 3.64600E+01, 2.70800E+01, 5.50600E+01, -2.34450E+02, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_56_00_1_4_PLC_1_01", "backgroundColor":"YellowGreen", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 1.05900E+01, -4.67800E+01, 9.19000E+00, -7.85800E+01, -9.06000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 3.88300E+01, -1.00850E+02, -7.47400E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, -7.85000E+00, 5.48900E+01, -1.17160E+02, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_56_00_1_4_PLC_1_01_CHS", "backgroundColor":"Lime", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 7.42000E+00, 2.45900E+01, 1.88500E+01, -1.91000E+01, 1.14000E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 1.82800E+01, -3.75300E+01, -6.26400E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_BACK_1_56_00_1_4_PLC_1_01_HRD", "backgroundColor":"Chartreuse", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, -8.06000E+00, 1.29500E+01, 1.21600E+01, -5.50000E+00, -4.82900E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_LAY_1_05_05_1_2_WIN_2_15", "backgroundColor":"SpringGreen", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 2.85000E+01, -2.20500E+02, 1.14000E+02, 0.00000E+00, 0.00000E+00, 2.85000E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00]}, {"label":"HORSE_LAY_1_05_05_1_2_WIN_2_40", "backgroundColor":"LightGreen", "data":[0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, -9.59390E+02, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00]}], "result":"OK", "context":"weeks"}'



function Do_Login() { // catch the form's submit event
      // Send data to server through the Ajax call
      // action is functionality we want to call and outputJSON is our data
      var user = document.forms['getform'].elements['username'].value;     

      var params = 'username=' + user;
      
      console.log("Do_Login: params" + params + "'");
      
      var xhr = new XMLHttpRequest();
      xhr.open('POST', URL + '/login');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.onload = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
              console.log(xhr.responseText);
              UpdateChart();
          }
      };
      xhr.send(params); 
}



///    options: {
///         scales: {
///           xAxes: [{ stacked: true }],
///           yAxes: [{ stacked: true }]
///         }
///       },


function UpdateChart() {
  feather.replace()
  // Graphs
  var ctx = document.getElementById('myChart')
  // eslint-disable-next-line no-unused-vars
  var myChart = new Chart(ctx, {
    type: 'bar',
    data: {},
    options: {
        title: {
            display: true,
            text: "Månadsvis"
        },    
        responsive: true,
        scales: {
           xAxes: [{ stacked: true }],
           yAxes: [{ stacked: true }]
        },
        tooltips: {
            mode: 'nearest',
            callbacks: {
                label: function(tooltipItem, data) {
                    var strategy = data.datasets[tooltipItem.datasetIndex].label;
                    var value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                    var total = 0;
                    for (var i = 0; i < data.datasets.length; i++)
                        total += data.datasets[i].data[tooltipItem.index];

                    return strategy + ' : ' + value.toFixed(2) + '   Totalt : ' + total.toFixed(2) ;    
                    //return strategy + " : " + value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '\n' +
                    // "Totalt : " + total.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') ;    
                    //if (tooltipItem.datasetIndex != data.datasets.length - 1) {
                    //    return strategy + " : " + value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    //} else {
                    //    return [strategy + " : " +value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'), "Totalt : " + total];
                    //}
                }
            }
        }
    },
  })

  var xhr3 = new XMLHttpRequest();
  var context = document.forms['getform'].elements['context'].value;     
 // var context = 'weeks';     
  var d = new Date();
  
  xhr3.open('GET', URL + '?milliseconds=' + d.getTime() + '&context=' + context);
  xhr3.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr3.onload = function() {
      if (xhr3.readyState == 4 && xhr3.status == 200) {
          var res = xhr3.responseText; 
          console.log(res);
          var j = JSON.parse(res);  
          myChart.data.labels = j.labels; //time/x-axis
          myChart.data.datasets = j.datasets;
          myChart.update();
      }
  };
  xhr3.send();

  
}

    
</script>
    <title>Betbot Statistics</title>
  </head>
  <body>
    
     <h2>Section title</h2>

    <div style='display:inline-block; border: 1px solid #CCC; border-radius: 6px; -webkit-border-radius: 6px; -o-border-radius: 6px; position: relative; overflow: hidden; width: 310px; height: 450px;'><iframe src='https://spotthestation.nasa.gov/widget/widget.cfm?country=Sweden&region=None&city=Lund' width='310' height='450' frameborder='0' ></iframe>
    </div>
    <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas>

    <hr/>
        <form id='getform'>
          <fieldset>
              <legend>Välj användare</legend>
              <label for='bnl'>Björn</label>
              <input type='radio' name='username' id='bnl' value='bnl' checked>
              <label for='jmb'>Joakim</label>
              <input type='radio' name='username' id='jmb' value='jmb'>
              <label for='msm'>Mats</label>
              <input type='radio' name='username' id='msm' value='msm'>
          </fieldset>
              <br/>
          <fieldset>
              <legend>och type</legend>
              <label for='months'>Måndadsvis</label>
              <input type='radio' name='context' id='months' value='months' checked>
              <label for='weeks'>Veckovis</label>
              <input type='radio' name='context' id='weeks' value='weeks'>
          </fieldset>
         <!-- <button type='button' onclick="Do_GetData(); return false;">Get Data</button> -->
          <button type='button' onclick="UpdateChart(); return false;">Uppdatera</button>
          <button type="button" onclick="Do_Login(); return false;">Login</button>
        </form>        
    
     
      
  </body>
</html>
